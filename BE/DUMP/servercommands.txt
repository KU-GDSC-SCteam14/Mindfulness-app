sudo apt update

sudo apt upgrade                                

git clone https://github.com/KU-GDSC-SCteam14/Mindfulness-app.git  //github 토큰classic

sudo apt install -y npm

sudo apt install -y python3-pip

sudo passwd                            //da&jld!93Q19

sudo apt-get install mysql-server

sudo systemctl start mysql

sudo systemctl enable mysql

sudo /usr/bin/mysql -u root

ALTER user 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'cA1!kJc&4uq';

sudo /usr/bin/mysql -u root -p                       
// cA1!kJc&4uq

use mysql

SELECT user, host, plugin FROM user;

CREATE USER 'moode-service'@'%' IDENTIFIED BY 'g!D!S!C14moode';

CREATE DATABASE moode_db;

GRANT SELECT, INSERT, UPDATE, CREATE, DELETE, INDEX, ALTER, LOCK TABLES, CREATE VIEW, SHOW VIEW, TRIGGER ON moode_db.* TO 'moode-service'@'%'; #%바꾸기

FLUSH PRIVILEGES;

USE moode_db;

CREATE TABLE User (
User_ID BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
Name VARCHAR(100) NOT NULL,
email VARCHAR(100) NOT NULL,
Signup_date DATETIME NOT NULL,
is_Google BOOLEAN NOT NULL,
is_Apple BOOLEAN NOT NULL,
Provider_ID VARCHAR(255) NOT NULL,
Access_Token VARCHAR(512) NOT NULL,
Refresh_Token VARCHAR(512) NOT NULL,
Token_Expiry_Date DATETIME NOT NULL,
Profile_Picture_URL VARCHAR(512)
);

CREATE TABLE Mood (
Mood_ID BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
Mood_name VARCHAR(100) NOT NULL,
Mood_value_min DECIMAL(5,4) NOT NULL,
Mood_value_max DECIMAL(5,4) NOT NULL
);

CREATE TABLE Diary (
Diary_ID BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
User_ID BIGINT UNSIGNED NOT NULL,
Title VARCHAR(255) NOT NULL,
Content_1 MEDIUMTEXT NOT NULL,
Content_2 MEDIUMTEXT NOT NULL,
Content_3 MEDIUMTEXT NOT NULL,
Date DATETIME NOT NULL,
Mood_ID BIGINT UNSIGNED,
FOREIGN KEY (User_ID) REFERENCES User(User_ID),
FOREIGN KEY (Mood_ID) REFERENCES Mood(Mood_ID)
);

CREATE TABLE AI_Data (
AI_Data_ID BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
Diary_ID BIGINT UNSIGNED NOT NULL,
Keywords_Extract MEDIUMTEXT NOT NULL,
Mood_value DECIMAL(5,4) NOT NULL,
FOREIGN KEY (Diary_ID) REFERENCES Diary(Diary_ID)
);

show tables;

desc User

SELECT * FROM User;

INSERT INTO User (Name, email, Signup_date, is_Google, is_Apple, Provider_ID, Access_Token, Refresh_Token, Token_Expiry_Date, Profile_Picture_URL) VALUES ('Testname', 'adjlsakj-testd212@example.testtest.com', '2024-02-13 12:00:00', True, False, 'test_provider_id', 'test_access_token', 'test_refresh_token', '2024-02-13 12:00:00', 'test_profile_picture_urla');

SELECT * FROM User;

SELECT * FROM User WHERE Name = 'Testname' AND Signup_date = '2024-02-13 12:00:00';

DELETE from User;

exit

cd /Mindfulness-app/BE

sudo npm install -g n

sudo n lts

sudo n prune

curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

nvm install node

sudo npm install

sudo apt-get update

node -v

ls -al

sudo nano .env

# 서버 설정
PORT=3000
CORS_ORIGIN=http://34.64.200.72

# 데이터베이스 설정
DB_HOST=localhost
DB_PORT=3306
DB_USER=moode-service
DB_PASSWORD=g!D!S!C14moode
DB_NAME=moode_db

# JWT 설정
JWT_SECRET_KEY=your_jwt_secret_key

# Google OAuth 설정
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Apple OAuth 설정
APPLE_CLIENT_ID=your_apple_client_id
APPLE_TEAM_ID=your_apple_team_id
APPLE_KEY_ID=your_apple_key_id
APPLE_PRIVATE_KEY_PATH=path_to_your_apple_private_key

sudo node app.js

sudo lsof -i :3000

sudo kill -9 PID
